
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Momentum &#8212; Trading</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Trading</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome to my Trading Book
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Section 1 - Applications
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="101_SimpleTimeSeries.html">
   1. Simple Time Series (Stock Prices)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="102_BasicTesting.html">
   2. Introduction to Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="104_TimeSeries.html">
   5. Time Series
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Section 2 - Statistics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="200_Introduction.html">
   6. Statistics
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/101_Momentum.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/isaac-flath/trading"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/isaac-flath/trading/issues/new?title=Issue%20on%20page%20%2F101_Momentum.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/isaac-flath/trading/edit/main/trading/101_Momentum.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/isaac-flath/trading/main?urlpath=tree/trading/101_Momentum.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/isaac-flath/trading/blob/main/trading/101_Momentum.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#intuition">
   Intuition
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#belief">
     Belief
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hypothesis">
     Hypothesis
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-data">
   The Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-data">
     Load data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#null-values">
     Null Values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#survivorship-bias">
     Survivorship bias
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reformat">
     Reformat
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validation-set">
     Validation Set
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#models">
   Models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basic-momentum">
     Basic Momentum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regression-momentum">
     Regression Momentum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bollinger-bands">
     Bollinger Bands
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#momentum-conclusion">
   Momentum Conclusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-s-next">
   What’s next
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Momentum</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#intuition">
   Intuition
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#belief">
     Belief
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hypothesis">
     Hypothesis
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-data">
   The Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-data">
     Load data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#null-values">
     Null Values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#survivorship-bias">
     Survivorship bias
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reformat">
     Reformat
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validation-set">
     Validation Set
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#models">
   Models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basic-momentum">
     Basic Momentum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regression-momentum">
     Regression Momentum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bollinger-bands">
     Bollinger Bands
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#momentum-conclusion">
   Momentum Conclusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-s-next">
   What’s next
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="momentum">
<h1>Momentum<a class="headerlink" href="#momentum" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastcore.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In this chapter we will use recent stock price history to make buy and sell decisions.  This is intended to be a first step in exploring quant trading.  Because we believe in learning by doing, starting in chapter 1 we will be building trading strategies!</p>
<p>Before diving into the technical bits, it is <em>always</em> a good idea to take the time to think about things at a high level and why your idea might work.  We can generate ideas <em>much</em> faster than we can code and test them, so we need to use intuition and experience to help guide us in which ideas we want to prioritize.  Intuition is important and where I start - but intuition is not reliable enough on it’s own - we <strong>must</strong> then turn intuition into code with rigorous testing before we can decide whether to implement the strategy.  Every chapter will start with this.</p>
</div>
<div class="section" id="intuition">
<h2>Intuition<a class="headerlink" href="#intuition" title="Permalink to this headline">¶</a></h2>
<div class="section" id="belief">
<h3>Belief<a class="headerlink" href="#belief" title="Permalink to this headline">¶</a></h3>
<p>I believe how a company is doing over the last month can be used to predict how how well it will do in the future.  This isn’t much of a leap, but let’s think about a few reasons as to why this may be true.</p>
<ul class="simple">
<li><p><strong>Available Capital:</strong> If a company is doing well, it typically means they have more profit.  More profit means more that can be reinvested.  More reinvestment can mean faster growth.</p></li>
<li><p><strong>Economies of Scale:</strong> Often the more successful a company is the more they can drive down cost in some areas.  For example, General Mills can buy sugar at a lower price than a small business due to their buying power.  As buying power increase, they can leverage that to drive down costs.</p></li>
<li><p><strong>Brand Recognition:</strong> The more successful a business is and the larger it grows, the more brand recognition it has.  The more brand recognition it has the more it can leverage it’s brand to grow.</p></li>
</ul>
</div>
<div class="section" id="hypothesis">
<h3>Hypothesis<a class="headerlink" href="#hypothesis" title="Permalink to this headline">¶</a></h3>
<p>The <em>hypothesis</em> for this chapter is that recent stock performance can be used on its own to predict future stock performance.  Regardless of how much we believe that to be true, we should not trade based on this belief until we have evidence.  This chapter will explore several options for using this hypothesis to make trades.</p>
<p>The next chapter will give a foundation in testing and show how we can test and evaluate how well these approaches perform and determine if these are ideas worth keeping.</p>
</div>
</div>
<div class="section" id="the-data">
<h2>The Data<a class="headerlink" href="#the-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="load-data">
<h3>Load data<a class="headerlink" href="#load-data" title="Permalink to this headline">¶</a></h3>
<p>First let’s take a look at the data we will be using and talk a bit about it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;eod-quotemedia.csv&#39;</span><span class="p">,</span><span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="n">raw</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>ticker</th>
      <th>adj_close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-07-01</td>
      <td>A</td>
      <td>29.994186</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-07-02</td>
      <td>A</td>
      <td>29.650137</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-07-03</td>
      <td>A</td>
      <td>29.705185</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can see that for each day we have a ticker.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A ticker is a symbol associated with a company.  For example Apple has the ticker <code class="docutils literal notranslate"><span class="pre">AAPL</span></code>.  To buy shares in Apple you would buy <code class="docutils literal notranslate"><span class="pre">AAPL</span></code>.</p>
</div>
<p>For each of these day|ticker combinations we have an <code class="docutils literal notranslate"><span class="pre">adj_close</span></code>, or adjusted close price.  After every transaction, the price of a stock changes slightly.  The <code class="docutils literal notranslate"><span class="pre">adjusted</span> <span class="pre">close</span> <span class="pre">price</span></code> is the last stock price of the day.  While this is not as detailed as having the price at a more granular level (second, minute, hour, etc.), called <code class="docutils literal notranslate"><span class="pre">tick</span></code> data, we can use daily close price to test many types of strategies.</p>
<p>::{note} This is the stock price for the ticker.  <code class="docutils literal notranslate"><span class="pre">adjusted</span></code> means that the prices have been adjusted to account for various actions, such as stock splits (more discussion on this later).  <code class="docutils literal notranslate"><span class="pre">close</span></code> means that it is the price at close of market.</p>
<p>A good first step after getting tabular data is to use pandas’ describe method.  As we do this we see a few good pieces of information to keep in mind:</p>
<ul class="simple">
<li><p>Overall size of dataset - 409K rows</p></li>
<li><p>Very big range in values (~1 - ~1K), which most of them before $100</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>adj_close</th>
      <td>490737.0</td>
      <td>75.100472</td>
      <td>75.438804</td>
      <td>1.59</td>
      <td>36.782424</td>
      <td>57.499593</td>
      <td>87.4</td>
      <td>1011.34</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="null-values">
<h3>Null Values<a class="headerlink" href="#null-values" title="Permalink to this headline">¶</a></h3>
<p>Let’s take a look and make sure we don’t have any null values to handle.  This is one of those things you need to do with every dataset.  This is also a great opportunity to show how you can add in simple tests into your code as you go using an <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement, which will help you catch issues as you iterate and change things.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">o</span><span class="o">==</span><span class="mi">0</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">raw</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="survivorship-bias">
<h3>Survivorship bias<a class="headerlink" href="#survivorship-bias" title="Permalink to this headline">¶</a></h3>
<p>We also want to take a quick look at the non-numeric columns to get an idea of what time frame we have and how many tickers.  This is often known from the dataset, but it is good practice to look at the dataset and ensure that your understanding of the dataset aligns with what you see in the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date column contains dates from </span><span class="si">{</span><span class="n">raw</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">raw</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date column contains dates from 2013-07-01 to 2017-06-30
</pre></div>
</div>
</div>
</div>
<p>Let’s see if all tickers in the dataset have the same start and end date.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ticker_cnt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">_min</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[[</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ticker&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">_min</span> <span class="o">=</span> <span class="n">_min</span><span class="p">[</span><span class="n">_min</span><span class="o">.</span><span class="n">date</span> <span class="o">!=</span> <span class="s1">&#39;2013-07-01&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">date</span>

<span class="n">_max</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[[</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ticker&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">_max</span> <span class="o">=</span> <span class="n">_max</span><span class="p">[</span><span class="n">_max</span><span class="o">.</span><span class="n">date</span> <span class="o">!=</span> <span class="s1">&#39;2017-06-30&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">date</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&#39;&#39;Out of </span><span class="si">{</span><span class="n">ticker_cnt</span><span class="si">}</span><span class="s1"> tickers:</span>
<span class="s1">  + 20 do do not start on 2013-07-01</span>
<span class="s1">  + 0 do not have an entry for 2017-06-30&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Out of 495 tickers:
  + 20 do do not start on 2013-07-01
  + 0 do not have an entry for 2017-06-30
</pre></div>
</div>
</div>
</div>
<p>Good thing we checked!  Let’s think through what these two data points mean:</p>
<ul class="simple">
<li><p><strong>20 do do not start on 2013-07-01:</strong>  This makes sense because some of the companies may not have been founded or fit our criteria until after the start date of the dataset.  Maybe they were private companies that went public, or maybe they grew to a large enough size to be part of our universe.</p></li>
<li><p><strong>0 do not have an entry for 2017-06-30:</strong>  While it’s not definitive proof of an issue, it is cause for concern.  This dataset may have a survivorship bias built in.  Let’s talk about what survivorship bias is and why this could be a problem.</p></li>
</ul>
<p>In our dataset we see that every ticker has a close price on the last day of the dataset.  This means that all of the companies are active at the end of our dataset.  What this means is that either:</p>
<ul class="simple">
<li><p>No company went out of business or failed in our universe between our July 2013 and June 2017 dates</p></li>
<li><p>Some companies did fail during our universe time period and our dataset does not reflect that.</p></li>
</ul>
<p>While either are possible, the second option is a common problem.  Let’s talk about why failed companies not being a part of our universe is a problem.</p>
<p>Let’s say I look at the S&amp;P 500 companies in 2022 and build a dataset of their stock prices for 2015 - 2022. We want to tests how well a strategy would have performed in that time range.  Any trade has many outcomes for example:</p>
<ol class="simple">
<li><p>You could buy a stock and then the company goes out of business and you lose lots of money</p></li>
<li><p>You could buy a stock and then the price goes up and you profit</p></li>
<li><p>You could buy a stock and then the price goes down and you lose money</p></li>
</ol>
<p>The problem is that option #1 is <strong>impossible</strong> in this dataset.  We know none of the business went out of business between 2015 and 2022 because they were all in the S&amp;P 500 in 2022.  Option #1 is more likely than it should be because we already know the companies on the list are among the largest companies in 2022, so regardless of what company we pick we know it ends up a large company.  Option #3 is less likely than it should be because if a company shrunk in size to the point it’s not in the S&amp;P 500 in 2022 it’s not even in the dataset.  Our strategies may perform extremely well on our dataset, but when we run it on real data with real money we could be in for a shock!</p>
<p>Bottom line is we need <strong>point in time</strong> data, or rather data for a given date should only be as accurate as you could have known on that date.</p>
<p>When we see all tickers in the universe have a stock price on the last day, it’s important to verify that this did not happen in your dataset.  When we talk about testing later, we will talk about how we can test to ensure we have accurate results.</p>
</div>
<div class="section" id="reformat">
<h3>Reformat<a class="headerlink" href="#reformat" title="Permalink to this headline">¶</a></h3>
<p>Now that we have an basic idea of what’s in our data we can reformat it to a format that will be easier to use for analysis.  For what we are doing we will be applying things based on ticker, so let’s give each ticker it’s own column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;adj_close&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>ticker</th>
      <th>A</th>
      <th>AAL</th>
      <th>AAP</th>
      <th>AAPL</th>
      <th>ABBV</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-07-01</th>
      <td>29.994186</td>
      <td>16.176093</td>
      <td>81.138217</td>
      <td>53.109173</td>
      <td>34.924478</td>
    </tr>
    <tr>
      <th>2013-07-02</th>
      <td>29.650137</td>
      <td>15.819834</td>
      <td>80.722073</td>
      <td>54.312247</td>
      <td>35.428076</td>
    </tr>
    <tr>
      <th>2013-07-03</th>
      <td>29.705185</td>
      <td>16.127950</td>
      <td>81.237299</td>
      <td>54.612043</td>
      <td>35.444862</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can use the same describe as above to see statistics about each ticker.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>ticker</th>
      <th>A</th>
      <th>AAL</th>
      <th>AAP</th>
      <th>AAPL</th>
      <th>ABBV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1009.000000</td>
      <td>1009.000000</td>
      <td>1009.000000</td>
      <td>1009.000000</td>
      <td>1009.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>40.983757</td>
      <td>37.811501</td>
      <td>141.576280</td>
      <td>100.360320</td>
      <td>52.977953</td>
    </tr>
    <tr>
      <th>std</th>
      <td>5.850163</td>
      <td>8.816410</td>
      <td>26.260390</td>
      <td>22.660593</td>
      <td>7.897264</td>
    </tr>
    <tr>
      <th>min</th>
      <td>29.650137</td>
      <td>14.770314</td>
      <td>78.393647</td>
      <td>53.109173</td>
      <td>34.924478</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>37.656517</td>
      <td>34.383874</td>
      <td>125.561609</td>
      <td>87.186576</td>
      <td>46.981317</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>39.700762</td>
      <td>39.218491</td>
      <td>147.450711</td>
      <td>102.884811</td>
      <td>53.983957</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>43.944859</td>
      <td>43.681272</td>
      <td>159.019446</td>
      <td>114.257784</td>
      <td>59.212432</td>
    </tr>
    <tr>
      <th>max</th>
      <td>60.131015</td>
      <td>54.071539</td>
      <td>199.374304</td>
      <td>153.694280</td>
      <td>70.780784</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="validation-set">
<h3>Validation Set<a class="headerlink" href="#validation-set" title="Permalink to this headline">¶</a></h3>
<p>We are going to split our data into 2 groups.  This way we have a secondary unseen dataset to test my strategies.  I want to develop models on one set of data but evaluate them on different data.  This may not seem important but it is absolutely crucial and perhaps the most important concept in this book.  The more complex your model and analysis the more important this becomes.  This will be discussed in much greater detail in chapter 2, but for now just take my word for it.</p>
<p>With time series you generally want your validation set to be the most recent data.  This reflects reality best; creating a model on data with the intent to use it on future data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2017-1-1 01:00:00&#39;</span><span class="p">)]</span>
<span class="n">valid</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2017-1-1 01:00:00&#39;</span><span class="p">):]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train Dates: </span><span class="si">{</span><span class="n">train</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2"> thru </span><span class="si">{</span><span class="n">train</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Valid Dates: </span><span class="si">{</span><span class="n">valid</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2"> thru </span><span class="si">{</span><span class="n">valid</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train Dates: 2013-07-01 thru 2016-12-30
Valid Dates: 2017-01-03 thru 2017-06-30
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="models">
<h2>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-momentum">
<h3>Basic Momentum<a class="headerlink" href="#basic-momentum" title="Permalink to this headline">¶</a></h3>
<p>As our first model let’s use percent change over recent stock price history.  We will take the percent difference between the current stock price and the stock price from a set time in the past.  As we think about this approach there are several levers we can pull time find tune our approach:</p>
<ul class="simple">
<li><p><strong>Time Range:</strong> We could use the past 5 days, or past 30 days, or the past year.  How far back should we be comparing?</p></li>
<li><p><strong>Threshold:</strong> What threshold do we need to cross before we consider it momentous enough to take an action?  Is a 1%, 5%, 10%?</p></li>
<li><p><strong>What action?</strong>  Is it just buy and sell?  Could we use this to short?</p></li>
<li><p><strong>When do we close our position</strong>  Is it a set time period?  Or based on another threshold?</p></li>
</ul>
<p>We will use 28 days for the time range and 8% for our threshold in this example to demonstrate the concept, but in the testing section we will show how to test different parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_momentum_actions</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_periods</span><span class="p">,</span><span class="n">threshold</span><span class="p">):</span>
    <span class="n">_x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">n_periods</span><span class="p">)</span>
    
    <span class="c1"># Calculate percent change</span>
    <span class="n">momentum_rate</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">n_periods</span><span class="p">))</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">n_periods</span><span class="p">))[</span><span class="n">n_periods</span><span class="p">:]</span>

    <span class="c1"># Select Action Based on Threshold</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">momentum_rate</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">threshold</span><span class="p">,</span> <span class="s1">&#39;Short&#39;</span><span class="p">,</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">momentum_rate</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span>  <span class="s1">&#39;Buy&#39;</span><span class="p">,</span>
                                                                 <span class="s1">&#39;&#39;</span><span class="p">)),</span>
                   <span class="n">columns</span><span class="o">=</span><span class="n">momentum_rate</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">momentum_rate</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    
    <span class="c1"># Because we use close price, we can&#39;t make the trade action until the following day</span>
    <span class="n">actions</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">actions</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">actions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">actions</span> <span class="o">=</span> <span class="n">get_momentum_actions</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">5</span><span class="p">],</span><span class="n">n_periods</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>
<span class="n">actions</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>ticker</th>
      <th>A</th>
      <th>AAL</th>
      <th>AAP</th>
      <th>AAPL</th>
      <th>ABBV</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-08-10</th>
      <td></td>
      <td>Buy</td>
      <td></td>
      <td>Buy</td>
      <td>Buy</td>
    </tr>
    <tr>
      <th>2013-08-13</th>
      <td></td>
      <td>Buy</td>
      <td></td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-14</th>
      <td>Buy</td>
      <td></td>
      <td></td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-15</th>
      <td></td>
      <td></td>
      <td></td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-16</th>
      <td></td>
      <td></td>
      <td></td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-17</th>
      <td></td>
      <td></td>
      <td></td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-20</th>
      <td></td>
      <td>Short</td>
      <td></td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-21</th>
      <td></td>
      <td>Short</td>
      <td></td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-22</th>
      <td></td>
      <td>Short</td>
      <td></td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-23</th>
      <td></td>
      <td>Short</td>
      <td></td>
      <td>Buy</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>This leaves us with a table of what actions we are going to execute each day for each stock.  Let’s look at some other options for using this momentum-esque concept, and then we can test them all and compare how they perform at the end.</p>
</div>
<div class="section" id="regression-momentum">
<h3>Regression Momentum<a class="headerlink" href="#regression-momentum" title="Permalink to this headline">¶</a></h3>
<p>Our previous approach was just the percent change between 2 dates.  But what if one of those days is an outlier?  Should we really make a decision based on just 2 data points?  To address this concerns we will define momentum slightly differently with the slope of a fit regression.</p>
<p>First, let’s understand the general concept better.  Creating these minimal examples and visuals is <em>not</em> just something educational for a book - you should do this in your own projects as well.  It will help you think more deeply about your problem.</p>
<p>Below I took the stock price for Apple in a 10 day period and plotted it as a scatter plot.  Every 4 data points I fit a regression trend line fit to them.  We can see that in some groups the trend a very aggressive upward slope, others it’s more neutral, and in others it is a strong negative slope.  By using that slope we can determine how much momentum the group of points has.  In this way we use all the recent data points to influence momentum and not just the first and last in a period.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create Figure</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Window Regression Lines&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># Get 10 data points</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> 

<span class="n">x1</span> <span class="o">=</span> <span class="n">_</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">day</span><span class="o">.</span><span class="n">values</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">_</span><span class="o">.</span><span class="n">values</span>

<span class="n">sz</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># Window Size</span>

<span class="c1"># Get Windows for x and y</span>
<span class="n">regr_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y1</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">sz</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">sz</span><span class="o">-</span><span class="mi">1</span><span class="p">))]</span>
<span class="n">regr_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">sz</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">sz</span><span class="o">-</span><span class="mi">1</span><span class="p">))]</span>

<span class="c1"># Create Regression lines</span>
<span class="n">regr</span> <span class="o">=</span> <span class="p">[</span><span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">regr_x</span><span class="p">,</span><span class="n">regr_y</span><span class="p">)]</span>

<span class="c1"># Pad Regression Lines for Plotting</span>
<span class="n">regr_padded</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">+</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span><span class="o">-</span><span class="n">sz</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">regr</span><span class="p">)]</span>

<span class="c1"># Plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">y1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">regr</span><span class="p">)):</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">regr_padded</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/101_Momentum_48_0.png" src="_images/101_Momentum_48_0.png" />
</div>
</div>
<p>So we take the slope of the trend line to be our momentum.  There are very similar levers as before we can change to fine tune out approach:</p>
<ul class="simple">
<li><p><strong>Time Range:</strong> We could use the past 5 days, or past 30 days, or the past year.  How far back should we be comparing?</p></li>
<li><p><strong>Threshold:</strong> What threshold do we need to cross before we consider it momentous enough to take an action?  Is a slope of 1? Slope of 10?  Should we do something other than a set value?</p></li>
<li><p><strong>What action?</strong>  Is it just buy and sell?  Could we use this to short?</p></li>
<li><p><strong>When do we close our position</strong>  Is it a set time period?  Or based on another threshold?</p></li>
</ul>
<p>We will use 28 days for the time range and $5 for our threshold in this example to demonstrate the concept, but in the testing section we will show how to test different parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We are assuming that every day is equally spaced in this regression.  I reality, the stock market is not open daily.  We are ignoring this for this analysis to keep things simple, but it will be something for us to revisit later in the book!</p>
<p>In this section we are using a straight dollar threshold instead of a percentage.  This can cause difficulties because a ticker with a share price at 20 dollars increasing to 25 dollars is a HUGE increase.  If a stock goes from 500 to 505 dollars that is not nearly as big of a deal.  The point of this chapter is to show variety of options and get you thinking so we will keep this one as is and see how it shakes out when we test it the approach.</p>
<p>Let’s codify our approach so we have a function we can use to test with later.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_momentum_regr_actions</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_periods</span><span class="p">,</span><span class="n">threshold</span><span class="p">):</span>
    <span class="n">_x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">n_periods</span><span class="p">)</span>
    
    <span class="c1"># Calculate Momentum</span>
    <span class="n">mom_window</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">n_periods</span><span class="p">)</span>
    <span class="n">mom_rate</span> <span class="o">=</span> <span class="n">mom_window</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span>
                                    <span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_periods</span><span class="p">))</span><span class="o">.</span>
                                    <span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
    <span class="n">mom_rate</span> <span class="o">=</span> <span class="n">mom_rate</span><span class="p">[</span><span class="n">n_periods</span><span class="p">:]</span>
    
    <span class="c1"># Select Action Based on Threshold</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mom_rate</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">threshold</span><span class="p">,</span> <span class="s1">&#39;Short&#39;</span><span class="p">,</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mom_rate</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span>  <span class="s1">&#39;Buy&#39;</span><span class="p">,</span>
                                                                 <span class="s1">&#39;&#39;</span><span class="p">)),</span>
                   <span class="n">columns</span><span class="o">=</span><span class="n">mom_rate</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">mom_rate</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    
    <span class="c1"># Because we use close price, we can&#39;t make the trade action until the following day</span>
    <span class="n">actions</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">actions</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">actions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">actions</span> <span class="o">=</span> <span class="n">get_momentum_regr_actions</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">]],</span><span class="n">n_periods</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">.24</span><span class="p">)</span>
<span class="n">actions</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>ticker</th>
      <th>AAPL</th>
      <th>ZBH</th>
      <th>XOM</th>
      <th>AAL</th>
      <th>ALXN</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-08-10</th>
      <td>Buy</td>
      <td>Buy</td>
      <td></td>
      <td></td>
      <td>Buy</td>
    </tr>
    <tr>
      <th>2013-08-13</th>
      <td>Buy</td>
      <td>Buy</td>
      <td></td>
      <td></td>
      <td>Buy</td>
    </tr>
    <tr>
      <th>2013-08-14</th>
      <td>Buy</td>
      <td></td>
      <td></td>
      <td></td>
      <td>Buy</td>
    </tr>
    <tr>
      <th>2013-08-15</th>
      <td>Buy</td>
      <td></td>
      <td></td>
      <td></td>
      <td>Buy</td>
    </tr>
    <tr>
      <th>2013-08-16</th>
      <td>Buy</td>
      <td></td>
      <td></td>
      <td></td>
      <td>Buy</td>
    </tr>
    <tr>
      <th>2013-08-17</th>
      <td>Buy</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-20</th>
      <td>Buy</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-21</th>
      <td>Buy</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-22</th>
      <td>Buy</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-23</th>
      <td>Buy</td>
      <td></td>
      <td>Short</td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="bollinger-bands">
<h3>Bollinger Bands<a class="headerlink" href="#bollinger-bands" title="Permalink to this headline">¶</a></h3>
<p>A bollinger band uses a rolling standard deviation to determine when the stock price is unusually high or low.  In theory if the price is doing something unexpected we can capitalize on that.  So rather than a percent change, or a regression line, we are now picking it based on whether it’s unusually high or low per the standard deviation.</p>
<p>Let’s walk through graphing a bolldinger band this on a couple tickers so we understand what’s going on.  Then we can figure out how to use this to create a trading strategy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_bollinger</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tickers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span><span class="s1">&#39;MSFT&#39;</span><span class="p">],</span><span class="n">window_sz</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span><span class="n">band_sz</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span><span class="p">:</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">ticker</span><span class="p">]</span> 
        
        <span class="c1"># Calculate window statistics</span>
        <span class="n">_mean</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window_sz</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">_std</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window_sz</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

        <span class="c1"># Calculate bands based on window statistics</span>
        <span class="n">upper_band</span> <span class="o">=</span> <span class="n">_mean</span> <span class="o">+</span> <span class="p">(</span><span class="n">band_sz</span><span class="o">*</span><span class="n">_std</span><span class="p">)</span>
        <span class="n">lower_band</span> <span class="o">=</span> <span class="n">_mean</span> <span class="o">-</span> <span class="p">(</span><span class="n">band_sz</span><span class="o">*</span><span class="n">_std</span><span class="p">)</span>
        
        <span class="c1"># Combine in a dataframe</span>
        <span class="n">_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">lower_band</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">upper_band</span><span class="p">,</span> <span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">_out</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lower_band&#39;</span><span class="p">,</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span><span class="s1">&#39;upper_band&#39;</span><span class="p">]</span>
        <span class="n">_out</span><span class="p">[</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_out</span><span class="o">.</span><span class="n">raw</span> <span class="o">&lt;</span> <span class="n">_out</span><span class="o">.</span><span class="n">lower_band</span>
        <span class="n">_out</span><span class="p">[</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_out</span><span class="o">.</span><span class="n">raw</span> <span class="o">&gt;</span> <span class="n">_out</span><span class="o">.</span><span class="n">upper_band</span>

        <span class="n">out</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span> <span class="o">=</span> <span class="n">_out</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="n">calculate_bollinger</span><span class="p">(</span><span class="n">train</span><span class="p">,[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span><span class="s1">&#39;MSFT&#39;</span><span class="p">,</span><span class="s1">&#39;GOOG&#39;</span><span class="p">,</span><span class="s1">&#39;AMZN&#39;</span><span class="p">])[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lower_band</th>
      <th>raw</th>
      <th>upper_band</th>
      <th>lower_limit</th>
      <th>upper_limit</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-05-16</th>
      <td>65.673907</td>
      <td>79.424990</td>
      <td>83.692943</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2016-08-12</th>
      <td>89.257772</td>
      <td>105.078696</td>
      <td>107.782655</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2015-11-16</th>
      <td>102.484765</td>
      <td>109.050672</td>
      <td>118.190435</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_bollinger</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">min_date</span><span class="p">,</span><span class="n">plt_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="c1"># Create Plot    </span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">/</span><span class="n">plt_cols</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="n">plt_cols</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="o">*</span><span class="n">rows</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Bollinger Bands&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    
    <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">ticker</span><span class="p">,</span><span class="n">df</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="c1"># Determind plot location</span>
        <span class="n">row_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">plt_cols</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">i</span>
        <span class="n">col_num</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="p">(</span><span class="n">row_num</span> <span class="o">*</span> <span class="n">plt_cols</span><span class="p">)</span>
        
        <span class="c1"># Filter for dates</span>
        <span class="n">_d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;=</span><span class="n">min_date</span><span class="p">]</span>
        
        <span class="c1"># Draw Plots</span>
        <span class="k">if</span> <span class="n">plt_cols</span> <span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span> <span class="n">_tmp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row_num</span><span class="p">,</span><span class="n">col_num</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">_tmp</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row_num</span><span class="p">]</span>
        <span class="n">_tmp</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">_tmp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_d</span><span class="p">[[</span><span class="s1">&#39;lower_band&#39;</span><span class="p">,</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span><span class="s1">&#39;upper_band&#39;</span><span class="p">]])</span>
        <span class="n">_tmp</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">_d</span><span class="p">[</span><span class="n">_d</span><span class="o">.</span><span class="n">lower_limit</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">_d</span><span class="p">[</span><span class="n">_d</span><span class="o">.</span><span class="n">lower_limit</span><span class="p">]</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">_tmp</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">_d</span><span class="p">[</span><span class="n">_d</span><span class="o">.</span><span class="n">upper_limit</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">_d</span><span class="p">[</span><span class="n">_d</span><span class="o">.</span><span class="n">upper_limit</span><span class="p">]</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">plot_bollinger</span><span class="p">(</span><span class="n">calculate_bollinger</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">min_date</span><span class="o">=</span><span class="s1">&#39;2016-01-01&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/101_Momentum_55_0.png" src="_images/101_Momentum_55_0.png" />
</div>
</div>
<p>These charts show stock prices for Apple and Microsoft over time in orange.  The green is our upper band, which in this case is 2 standard deviations above the mean when looking at the last 28 days of the adjusted close price.  The blue is 2 standard deviations below the mean.</p>
<p>We’ve plotted red dots anywhere the stock price crosses these bounds.  This can only happen if there is a significant enough shift for it to be 2 standard deviations from the mean.  Let’s code up this third momentum-esque approach as well so we have a 3rd method to test.  Where the price crosses a bollinger band we will take an action!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_bollinger_actions</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">window_sz</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span><span class="n">band_sz</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    
    <span class="c1"># Calculate Statistics</span>
    <span class="n">bollinger_data</span> <span class="o">=</span> <span class="n">calculate_bollinger</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">tickers</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">window_sz</span><span class="o">=</span><span class="n">window_sz</span><span class="p">,</span><span class="n">band_sz</span><span class="o">=</span><span class="n">band_sz</span><span class="p">)</span>
    
    <span class="c1"># Calculate Actions</span>
    <span class="n">_d</span> <span class="o">=</span> <span class="n">L</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ticker</span><span class="p">,</span><span class="n">dataframe</span> <span class="ow">in</span> <span class="n">bollinger_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Short&#39;</span><span class="p">,</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span>  <span class="s1">&#39;Buy&#39;</span><span class="p">,</span>
                                                                 <span class="s1">&#39;&#39;</span><span class="p">)),</span>
                   <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">ticker</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
    <span class="n">bollinger_actions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">_d</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Because we use close price, we can&#39;t make the trade action until the following day</span>
    <span class="n">actions</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">actions</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">bollinger_actions</span><span class="p">[</span><span class="n">window_sz</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">actions</span> <span class="o">=</span> <span class="n">get_bollinger_actions</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">5</span><span class="p">],</span><span class="n">window_sz</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span><span class="n">band_sz</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">actions</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>AAL</th>
      <th>AAP</th>
      <th>AAPL</th>
      <th>ABBV</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-08-09</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-12</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-13</th>
      <td></td>
      <td>Short</td>
      <td>Buy</td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-14</th>
      <td></td>
      <td>Short</td>
      <td></td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-15</th>
      <td></td>
      <td>Short</td>
      <td></td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-16</th>
      <td></td>
      <td>Short</td>
      <td>Short</td>
      <td>Buy</td>
      <td>Short</td>
    </tr>
    <tr>
      <th>2013-08-19</th>
      <td></td>
      <td>Short</td>
      <td>Short</td>
      <td>Buy</td>
      <td></td>
    </tr>
    <tr>
      <th>2013-08-20</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>Short</td>
    </tr>
    <tr>
      <th>2013-08-21</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>Short</td>
    </tr>
    <tr>
      <th>2013-08-22</th>
      <td>Buy</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="momentum-conclusion">
<h2>Momentum Conclusion<a class="headerlink" href="#momentum-conclusion" title="Permalink to this headline">¶</a></h2>
<p>In this chapter we took a simple idea of using recent stock price changes to define a trading strategy.  One key thing I hope you took is even with simple concepts there are many ways that it can be approached - we created three.  You <strong>must</strong> be able to think deeply about what your options are and experiment with different approaches and understand what are all the things in these approach you can control or tweak.  You <strong>must</strong> be able to take ideas and translate them to code.</p>
<p>There are many more trading strategies that could be done using the same concepts in this chapter.  I encourage you to come up with one and implement it yourself.  That will be more difficult than reading the chapter was, but you will also learn more by doing that.  Once you do that write an explanation of why it might work, what you could tweak, and post post it in a github issue on our repository.  We’d love to see what you built!</p>
<p>Learn by building + write to learn = success</p>
</div>
<div class="section" id="what-s-next">
<h2>What’s next<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>In the next chapter we will introduce the most important and challenging topic in any predictive or modeling discipline, testing.  Effective testing is challenging and important because we need to be as confident as possible that the strategy we have will work “in the wild” just like we think it will.</p>
<p>There are many horror stories of models being put into production and because they were not properly tested they failed and lost the company tons of money.  On writing this chapter, the latest was Zillow.  Google “Zillow Model Failure” if you’d like to read up on it.  When the tests performed do not provide an accurate view of how the model will perform in production, you’ve got a big problem.  Understanding testing is crucial to a quant to minimize these unexpected catastrophic failures.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Isaac Flath & Felix Flath<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>